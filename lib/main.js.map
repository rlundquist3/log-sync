{"version":3,"file":"main.js","sources":["../src/parseNotes.js","../src/syncWithDatabase.js","../src/logSync.js","../src/main.js"],"sourcesContent":["const gradeRegEx = /(5\\.\\d+[a-d]|V\\d+)/;\n\nexport const parseNotes = (notes) =>\n  notes\n    .map((note) => {\n      const sendsSection = note.body.split(/\\*\\*noteworthy sends:\\*\\*/i)[1];\n      if (!!sendsSection) {\n        const sends = sendsSection\n          .split(/(-|\\n)/)\n          .filter((s) => !!s.match(gradeRegEx));\n\n        return sends.map((s) => {\n          const grade = s.match(gradeRegEx)[0];\n          return {\n            name: s.replace(`, ${grade}`, \"\").trim(),\n            grade,\n          };\n        });\n      }\n\n      return null;\n    })\n    .filter((s) => !!s)\n    .flat();\n","import { Client, fetchExchange, gql } from \"@urql/core\";\n\nconst client = new Client({\n  url: \"https://climb-log-api.vercel.app/graphql\",\n  exchanges: [fetchExchange],\n});\n\nconst createClimbsMutation = gql`\n  mutation CreateClimbs($input: [ClimbCreateInput!]!) {\n    createClimbs(input: $input) {\n      climbs {\n        id\n      }\n      info {\n        nodesCreated\n      }\n    }\n  }\n`;\n\nexport const syncWithDatabase = async (climbs) => {\n  const input = climbs.map(({ name, grade }) => ({\n    name,\n    grade,\n    type: !!grade.match(/V\\d+/) ? \"boulder\" : \"sport\",\n  }));\n\n  const { data } = await client.mutation(createClimbsMutation, { input });\n  console.log(\n    `${data?.createClimbs?.info?.nodesCreated} sends added to database`\n  );\n};\n","import { parseNotes } from \"./parseNotes\";\nimport { syncWithDatabase } from \"./syncWithDatabase\";\n\nexport const logSync = async () => {\n  console.log(\"Initialized\");\n\n  const db = inkdrop.main.dataStore.getLocalDB();\n  const sendsTag = await db.tags.findWithName(\"sends!\");\n  const syncedTag = await db.tags.findWithName(\"synced\");\n\n  // TODO: actually paginate and query\n  const notesWithSends = (\n    await db.notes.findWithTag(sendsTag._id, {\n      limit: 1000,\n    })\n  ).docs.filter(({ tags }) => !tags.includes(syncedTag._id));\n  console.log(notesWithSends);\n  console.log(`${notesWithSends.length} sessions to sync`);\n\n  const parsedClimbs = parseNotes(notesWithSends);\n  console.log(\"parsed\", parsedClimbs);\n\n  await syncWithDatabase(parsedClimbs);\n\n  const noteIds = notesWithSends.map(({ _id }) => _id);\n  await db.utils.setTagsBatch(noteIds, [syncedTag._id]);\n};\n","import LogSyncMessageDialog from \"./log-sync-message-dialog\";\nimport { logSync } from \"./logSync\";\n\nmodule.exports = {\n  activate() {\n    // inkdrop.components.registerClass(LogSyncMessageDialog);\n    // inkdrop.layouts.addComponentToLayout(\"modal\", \"LogSyncMessageDialog\");\n    logSync();\n  },\n\n  deactivate() {\n    // inkdrop.layouts.removeComponentFromLayout(\"modal\", \"LogSyncMessageDialog\");\n    // inkdrop.components.deleteClass(LogSyncMessageDialog);\n  },\n};\n"],"names":["gradeRegEx","parseNotes","notes","map","note","sendsSection","body","split","sends","filter","s","match","grade","name","replace","trim","flat","client","Client","url","exchanges","fetchExchange","createClimbsMutation","gql","syncWithDatabase","climbs","input","type","data","mutation","console","log","createClimbs","info","nodesCreated","logSync","db","inkdrop","main","dataStore","getLocalDB","sendsTag","tags","findWithName","syncedTag","notesWithSends","findWithTag","_id","limit","docs","includes","length","parsedClimbs","noteIds","utils","setTagsBatch","module","exports","activate","deactivate"],"mappings":"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"}